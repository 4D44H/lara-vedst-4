///<reference path="_references.ts"/>
$("#button-create-survey").click(function () {
    var errors = new Array();
    if ($("#description").val().length > 1500) {
        errors.push(translate("descriptionTooLong"));
    }
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});

///<reference path="_references.ts"/>
function getRowName(a) {
    return $(a).children("td").eq(0).text();
}
function getRowShifts(a) {
    return $(a).children("td").eq(1).text();
}
//inspired by http://stackoverflow.com/questions/3160277/jquery-table-sort
function sortLeaderboards(sortIcon) {
    var isAscending = sortIcon.hasClass('fa-sort-asc');
    var rowCatcher = sortIcon.parent().data('sort') === 'name' ? getRowName : getRowShifts;
    var $table = sortIcon.parents("table");
    var rows = $table
        .find("tbody")
        .find("tr")
        .toArray()
        .sort(function (a, b) { return rowCatcher(a).localeCompare(rowCatcher(b), undefined, { 'numeric': true }); });
    if (!isAscending) {
        rows.reverse();
    }
    rows.forEach(function (row) { return $table.append($(row)); });
    sortIcon.parents('table')
        .find('.fa-sort, .fa-sort-desc, .fa-sort-asc')
        .removeClass('fa-sort-asc')
        .removeClass('fa-sort-desc')
        .addClass('fa-sort');
    sortIcon.removeClass('fa-sort')
        .addClass(isAscending ? 'fa-sort-desc' : 'fa-sort-asc');
}
$(".fa-sort, .fa-sort-desc, .fa-sort-asc").click(function () {
    sortLeaderboards(this);
});
$('#leaderboardsTabs').find('thead').find('td').click(function () {
    sortLeaderboards($($(this).find('i').first()));
});
$(".statisticClubPicker").find("a").click(function () {
    var clubName = $(this).text().trim();
    localStorage.setItem('preferredStatistics', clubName);
});
$(".leaderboardsClubPicker").find("a").click(function () {
    var leaderBoardName = $(this).text().trim();
    localStorage.setItem('preferredLeaderboards', leaderBoardName);
});
$(function () {
    var preferredStatistics = localStorage.getItem('preferredStatistics');
    if (preferredStatistics) {
        $('.statisticClubPicker').find('a').filter(function () {
            return $(this).text().trim() === preferredStatistics;
        })
            .first()
            .click();
    }
    var preferredLeaderboards = localStorage.getItem('preferredLeaderboards');
    if (preferredLeaderboards) {
        $('.leaderboardsClubPicker').find('a').filter(function () {
            return $(this).text().trim() === preferredLeaderboards;
        })
            .first()
            .click();
    }
});

///<reference path="_references.ts"/>
var Club;
(function (Club) {
    Club[Club["None"] = 0] = "None";
    Club[Club["BcClub"] = 2] = "BcClub";
    Club[Club["BcCafe"] = 3] = "BcCafe";
    Club[Club["BdClub"] = 4] = "BdClub";
    Club[Club["BhClub"] = 5] = "BhClub";
    Club[Club["BiClub"] = 6] = "BiClub";
})(Club || (Club = {}));
function getIdOfClub(club) {
    switch (club) {
        case "bc-Club":
            return Club.BcClub;
        case "bc-Caf√©":
            return Club.BcCafe;
    }
    return Club.None;
}
function showErrorModal(message) {
    $("#errorModal").modal("show");
    $("#errorModal").find(".modal-body").html(message);
}

// external references go here
///<reference path="../typings/index.d.ts"/>
///<reference path="CreateEditEvent.ts"/>
///<reference path="CreateSurvey.ts"/>
///<reference path="StatisticsView.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="_references.ts"/>
// values of events that should trigger the selection of all clubs
var internalEventValues = [
    "1",
    "4",
    "5",
    "6",
    "9" // other
];
$("#button-create-submit").add("#button-edit-submit").click(function () {
    var beginDate = new Date($("[name='beginDate']").prop("value") + " " + $("[name='beginTime']").prop("value"));
    var endDate = new Date($("[name='endDate']").prop("value") + " " + $("[name='endTime']").prop("value"));
    // contains the keys to translations to be shown if the condition is fulfilled
    var errorConditions = {
        'endBeforeStart': beginDate.getTime() > endDate.getTime(),
        'forgotFilter': $("#filter-checkboxes").find("input[type=checkbox]:checked").length === 0,
        'forgotPreparation': $('[name="preparationTime"]').val() === "",
        'forgotStartTime': $('[name="beginTime"]').val() === "",
        'forgotEndTime': $('[name="endTime"]').val() === ""
    };
    var errors = Object.keys(errorConditions)
        .filter(function (key) { return errorConditions[key]; })
        .map(function (key) { return translate(key); });
    if (errors.length > 0) {
        bootbox.alert(errors.map(function (err) { return "<p>" + err + "</p>"; }).join("\n"));
        return false;
    }
});
$(function () {
    // if set, internal events will trigger selection of all clubs
    // if user sets the club manually, we want to keep his selection
    var autoSelectAllClubs = true;
    var allClubCheckBoxes = $("#filter").find("input[type=checkbox]");
    allClubCheckBoxes.click(function () {
        autoSelectAllClubs = false;
    });
    // important to use function() (anonymous function) here an not an arrow function
    // using an arrow function will change the "this" inside
    $("[name='evnt_type']").click(function () {
        var prop = $(this).val();
        var isInternalEvent = internalEventValues.indexOf(prop) !== -1;
        if (isInternalEvent) {
            if (autoSelectAllClubs) {
                $("#filter").find("input[type=checkbox]").prop("checked", true);
            }
        }
        else {
            // reset all checkboxes
            $("#filter").find("input[type=checkbox]").prop("checked", false);
            var clubName = $(document).find("#place").val();
            var clubId = getIdOfClub(clubName);
            if (clubId !== -1) {
                var showToClubCheckbox = $(document).find("[name=filterShowToClub" + clubId + "]");
                showToClubCheckbox.prop("checked", true);
            }
        }
    });
});

///<reference path="../typings/index.d.ts"/>
///<reference path="Utilities.ts"/>

///<reference path="../typings/index.d.ts"/>
var Question = (function () {
    function Question(element) {
        this.questionDiv = $(element).closest('[name^=question]');
    }
    return Question;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNyZWF0ZVN1cnZleS50cyIsIlN0YXRpc3RpY3NWaWV3LnRzIiwiVXRpbGl0aWVzLnRzIiwiX3JlZmVyZW5jZXMudHMiLCJDcmVhdGVFZGl0RXZlbnQudHMiLCJFdmVudFZpZXcudHMiLCJRdWVzdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxxQ0FBcUM7QUFFckMsQ0FBQyxDQUFDLHVCQUF1QixDQUFDLENBQUMsS0FBSyxDQUFDO0lBQzdCLElBQUksTUFBTSxHQUFHLElBQUksS0FBSyxFQUFVLENBQUM7SUFFakMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sR0FBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEtBQUssR0FBRyxHQUFHLEdBQUcsTUFBTSxFQUFwQixDQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDbEUsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNqQixDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7O0FDWkgscUNBQXFDO0FBRXJDLG9CQUFvQixDQUFTO0lBQ3pCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUM1QyxDQUFDO0FBRUQsc0JBQXNCLENBQVM7SUFDM0IsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMs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Q0FBQyx3QkFBd0IsR0FBRyxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQ25GLGtCQUFrQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDN0MsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDOztBQ2pFSCw0Q0FBNEM7QUFDNUMsbUNBQW1DOztBQ0RuQyw0Q0FBNEM7QUFFNUM7SUFJSSxrQkFBWSxPQUFlO1FBQ3ZCLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFDTCxlQUFDO0FBQUQsQ0FQQSxBQU9DLElBQUEiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vPHJlZmVyZW5jZSBwYXRoPVwiX3JlZmVyZW5jZXMudHNcIi8+XHJcblxyXG4kKFwiI2J1dHRvbi1jcmVhdGUtc3VydmV5XCIpLmNsaWNrKCgpID0+IHtcclxuICAgIGxldCBlcnJvcnMgPSBuZXcgQXJyYXk8c3RyaW5nPigpO1xyXG5cclxuICAgIGlmICgkKFwiI2Rlc2NyaXB0aW9uXCIpLnZhbCgpLmxlbmd0aCAgPiAxNTAwKSB7XHJcbiAgICAgICAgZXJyb3JzLnB1c2godHJhbnNsYXRlKFwiZGVzY3JpcHRpb25Ub29Mb25nXCIpKTtcclxuICAgIH1cclxuICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGJvb3Rib3guYWxlcnQoZXJyb3JzLm1hcChlcnIgPT4gXCI8cD5cIiArIGVyciArIFwiPC9wPlwiKS5qb2luKFwiXFxuXCIpKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuXHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIl9yZWZlcmVuY2VzLnRzXCIvPlxyXG5cclxuZnVuY3Rpb24gZ2V0Um93TmFtZShhOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiAkKGEpLmNoaWxkcmVuKFwidGRcIikuZXEoMCkudGV4dCgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRSb3dTaGlmdHMoYTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gJChhKS5jaGlsZHJlbihcInRkXCIpLmVxKDEpLnRleHQoKTtcclxufVxyXG5cclxuXHJcbi8vaW5zcGlyZWQgYnkgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMTYwMjc3L2pxdWVyeS10YWJsZS1zb3J0XHJcbmZ1bmN0aW9uIHNvcnRMZWFkZXJib2FyZHMoc29ydEljb246IEpRdWVyeSkge1xyXG4gICAgbGV0IGlzQXNjZW5kaW5nID0gc29ydEljb24uaGFzQ2xhc3MoJ2ZhLXNvcnQtYXNjJyk7XHJcbiAgICBsZXQgcm93Q2F0Y2hlciA9IHNvcnRJY29uLnBhcmVudCgpLmRhdGEoJ3NvcnQnKSA9PT0gJ25hbWUnID8gZ2V0Um93TmFtZSA6IGdldFJvd1NoaWZ0cztcclxuICAgIGxldCAkdGFibGUgPSBzb3J0SWNvbi5wYXJlbnRzKFwidGFibGVcIik7XHJcbiAgICBsZXQgcm93cyA9ICR0YWJsZVxyXG4gICAgICAgIC5maW5kKFwidGJvZHlcIilcclxuICAgICAgICAuZmluZChcInRyXCIpXHJcbiAgICAgICAgLnRvQXJyYXkoKVxyXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiByb3dDYXRjaGVyKGEpLmxvY2FsZUNvbXBhcmUocm93Q2F0Y2hlcihiKSwgdW5kZWZpbmVkLCB7J251bWVyaWMnOiB0cnVlfSkpO1xyXG4gICAgaWYgKCFpc0FzY2VuZGluZykge1xyXG4gICAgICAgIHJvd3MucmV2ZXJzZSgpO1xyXG4gICAgfVxyXG4gICAgcm93cy5mb3JFYWNoKHJvdyA9PiAkdGFibGUuYXBwZW5kKCQocm93KSkpO1xyXG4gICAgc29ydEljb24ucGFyZW50cygndGFibGUnKVxyXG4gICAgICAgIC5maW5kKCcuZmEtc29ydCwgLmZhLXNvcnQtZGVzYywgLmZhLXNvcnQtYXNjJylcclxuICAgICAgICAucmVtb3ZlQ2xhc3MoJ2ZhLXNvcnQtYXNjJylcclxuICAgICAgICAucmVtb3ZlQ2xhc3MoJ2ZhLXNvcnQtZGVzYycpXHJcbiAgICAgICAgLmFkZENsYXNzKCdmYS1zb3J0Jyk7XHJcbiAgICBzb3J0SWNvbi5yZW1vdmVDbGFzcygnZmEtc29ydCcpXHJcbiAgICAgICAgLmFkZENsYXNzKGlzQXNjZW5kaW5nID8gJ2ZhLXNvcnQtZGVzYycgOiAnZmEtc29ydC1hc2MnKTtcclxufVxyXG4kKFwiLmZhLXNvcnQsIC5mYS1zb3J0LWRlc2MsIC5mYS1zb3J0LWFzY1wiKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICBzb3J0TGVhZGVyYm9hcmRzKHRoaXMpO1xyXG59KTtcclxuXHJcbiQoJyNsZWFkZXJib2FyZHNUYWJzJykuZmluZCgndGhlYWQnKS5maW5kKCd0ZCcpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgc29ydExlYWRlcmJvYXJkcygkKCQodGhpcykuZmluZCgnaScpLmZpcnN0KCkpKTtcclxufSk7XHJcblxyXG4kKFwiLnN0YXRpc3RpY0NsdWJQaWNrZXJcIikuZmluZChcImFcIikuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICBsZXQgY2x1Yk5hbWUgPSAkKHRoaXMpLnRleHQoKS50cmltKCk7XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncHJlZmVycmVkU3RhdGlzdGljcycsIGNsdWJOYW1lKTtcclxufSk7XHJcblxyXG4kKFwiLmxlYWRlcmJvYXJkc0NsdWJQaWNrZXJcIikuZmluZChcImFcIikuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICBsZXQgbGVhZGVyQm9hcmROYW1lID0gJCh0aGlzKS50ZXh0KCkudHJpbSgpO1xyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3ByZWZlcnJlZExlYWRlcmJvYXJkcycsIGxlYWRlckJvYXJkTmFtZSk7XHJcbn0pXHJcblxyXG4kKCgpID0+IHtcclxuICAgIGxldCBwcmVmZXJyZWRTdGF0aXN0aWNzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3ByZWZlcnJlZFN0YXRpc3RpY3MnKTtcclxuICAgIGlmIChwcmVmZXJyZWRTdGF0aXN0aWNzKSB7XHJcbiAgICAgICAgJCgnLnN0YXRpc3RpY0NsdWJQaWNrZXInKS5maW5kKCdhJykuZmlsdGVyKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKS50ZXh0KCkudHJpbSgpID09PSBwcmVmZXJyZWRTdGF0aXN0aWNzO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5maXJzdCgpXHJcbiAgICAgICAgICAgIC5jbGljaygpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBwcmVmZXJyZWRMZWFkZXJib2FyZHMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHJlZmVycmVkTGVhZGVyYm9hcmRzJyk7XHJcbiAgICBpZiAocHJlZmVycmVkTGVhZGVyYm9hcmRzKSB7XHJcbiAgICAgICAgJCgnLmxlYWRlcmJvYXJkc0NsdWJQaWNrZXInKS5maW5kKCdhJykuZmlsdGVyKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKS50ZXh0KCkudHJpbSgpID09PSBwcmVmZXJyZWRMZWFkZXJib2FyZHM7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmZpcnN0KClcclxuICAgICAgICAgICAgLmNsaWNrKCk7XHJcbiAgICB9XHJcblxyXG59KTtcclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiX3JlZmVyZW5jZXMudHNcIi8+XHJcbmVudW0gQ2x1YiB7XHJcbiAgICBOb25lLFxyXG4gICAgQmNDbHViID0gMixcclxuICAgIEJjQ2FmZSxcclxuICAgIEJkQ2x1YixcclxuICAgIEJoQ2x1YixcclxuICAgIEJpQ2x1YlxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRJZE9mQ2x1YiAoY2x1Yjogc3RyaW5nKTogQ2x1YiB7XHJcbiAgICBzd2l0Y2ggKGNsdWIpIHtcclxuICAgICAgICBjYXNlIFwiYmMtQ2x1YlwiOlxyXG4gICAgICAgICAgICByZXR1cm4gQ2x1Yi5CY0NsdWI7XHJcbiAgICAgICAgY2FzZSBcImJjLUNhZsOpXCI6XHJcbiAgICAgICAgICAgIHJldHVybiBDbHViLkJjQ2FmZTtcclxuICAgIH1cclxuICAgIHJldHVybiBDbHViLk5vbmU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNob3dFcnJvck1vZGFsKG1lc3NhZ2U6IHN0cmluZykge1xyXG4gICAgJChcIiNlcnJvck1vZGFsXCIpLm1vZGFsKFwic2hvd1wiKTtcclxuICAgICQoXCIjZXJyb3JNb2RhbFwiKS5maW5kKFwiLm1vZGFsLWJvZHlcIikuaHRtbChtZXNzYWdlKTtcclxufVxyXG4iLCIvLyBleHRlcm5hbCByZWZlcmVuY2VzIGdvIGhlcmVcclxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIvPlxyXG5cclxuLy8gaW50ZXJuYWwgcmVmZXJlbmNlIGdvIGhlcmVcclxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiQ3JlYXRlRWRpdEV2ZW50LnRzXCIvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9XCJDcmVhdGVTdXJ2ZXkudHNcIi8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIlN0YXRpc3RpY3NWaWV3LnRzXCIvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9XCJVdGlsaXRpZXMudHNcIi8+XHJcblxyXG5kZWNsYXJlIGxldCB0cmFuc2xhdGU6IChrZXk6IHN0cmluZykgPT4gc3RyaW5nO1xyXG5cclxuXHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIl9yZWZlcmVuY2VzLnRzXCIvPlxyXG5cclxuLy8gdmFsdWVzIG9mIGV2ZW50cyB0aGF0IHNob3VsZCB0cmlnZ2VyIHRoZSBzZWxlY3Rpb24gb2YgYWxsIGNsdWJzXHJcbmxldCBpbnRlcm5hbEV2ZW50VmFsdWVzID0gW1xyXG4gICAgXCIxXCIsIC8vIEluZm9cclxuICAgIFwiNFwiLCAvLyBJbnRlcm5hbCBldmVudFxyXG4gICAgXCI1XCIsIC8vIHByaXZhdGUgcGFydHlcclxuICAgIFwiNlwiLCAvLyBjbGVhbmluZ1xyXG4gICAgXCI5XCIgIC8vIG90aGVyXHJcbl07XHJcblxyXG4kKFwiI2J1dHRvbi1jcmVhdGUtc3VibWl0XCIpLmFkZChcIiNidXR0b24tZWRpdC1zdWJtaXRcIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIGxldCBiZWdpbkRhdGUgPSBuZXcgRGF0ZSgkKFwiW25hbWU9J2JlZ2luRGF0ZSddXCIpLnByb3AoXCJ2YWx1ZVwiKSArIFwiIFwiICsgJChcIltuYW1lPSdiZWdpblRpbWUnXVwiKS5wcm9wKFwidmFsdWVcIikpO1xyXG4gICAgbGV0IGVuZERhdGUgPSBuZXcgRGF0ZSgkKFwiW25hbWU9J2VuZERhdGUnXVwiKS5wcm9wKFwidmFsdWVcIikgKyBcIiBcIiArICQoXCJbbmFtZT0nZW5kVGltZSddXCIpLnByb3AoXCJ2YWx1ZVwiKSk7XHJcblxyXG4gICAgLy8gY29udGFpbnMgdGhlIGtleXMgdG8gdHJhbnNsYXRpb25zIHRvIGJlIHNob3duIGlmIHRoZSBjb25kaXRpb24gaXMgZnVsZmlsbGVkXHJcbiAgICBsZXQgZXJyb3JDb25kaXRpb25zOiB7W2tleTogc3RyaW5nXTogYm9vbGVhbn0gPSB7XHJcbiAgICAgICAgJ2VuZEJlZm9yZVN0YXJ0JzogYmVnaW5EYXRlLmdldFRpbWUoKSA+IGVuZERhdGUuZ2V0VGltZSgpLFxyXG4gICAgICAgICdmb3Jnb3RGaWx0ZXInOiAkKFwiI2ZpbHRlci1jaGVja2JveGVzXCIpLmZpbmQoXCJpbnB1dFt0eXBlPWNoZWNrYm94XTpjaGVja2VkXCIpLmxlbmd0aCA9PT0gMCxcclxuICAgICAgICAnZm9yZ290UHJlcGFyYXRpb24nOiAkKCdbbmFtZT1cInByZXBhcmF0aW9uVGltZVwiXScpLnZhbCgpID09PSBcIlwiLFxyXG4gICAgICAgICdmb3Jnb3RTdGFydFRpbWUnOiAkKCdbbmFtZT1cImJlZ2luVGltZVwiXScpLnZhbCgpID09PSBcIlwiLFxyXG4gICAgICAgICdmb3Jnb3RFbmRUaW1lJzogJCgnW25hbWU9XCJlbmRUaW1lXCJdJykudmFsKCkgPT09IFwiXCJcclxuICAgIH07XHJcblxyXG4gICAgbGV0IGVycm9ycyA9IE9iamVjdC5rZXlzKGVycm9yQ29uZGl0aW9ucylcclxuICAgICAgICAuZmlsdGVyKGtleSA9PiBlcnJvckNvbmRpdGlvbnNba2V5XSlcclxuICAgICAgICAubWFwKGtleSA9PiB0cmFuc2xhdGUoa2V5KSk7XHJcblxyXG4gICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgYm9vdGJveC5hbGVydChlcnJvcnMubWFwKGVyciA9PiBcIjxwPlwiICsgZXJyICsgXCI8L3A+XCIpLmpvaW4oXCJcXG5cIikpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufSk7XHJcbiQoKCkgPT4ge1xyXG4gICAgLy8gaWYgc2V0LCBpbnRlcm5hbCBldmVudHMgd2lsbCB0cmlnZ2VyIHNlbGVjdGlvbiBvZiBhbGwgY2x1YnNcclxuICAgIC8vIGlmIHVzZXIgc2V0cyB0aGUgY2x1YiBtYW51YWxseSwgd2Ugd2FudCB0byBrZWVwIGhpcyBzZWxlY3Rpb25cclxuICAgIGxldCBhdXRvU2VsZWN0QWxsQ2x1YnMgPSB0cnVlO1xyXG4gICAgbGV0IGFsbENsdWJDaGVja0JveGVzID0gJChcIiNmaWx0ZXJcIikuZmluZChcImlucHV0W3R5cGU9Y2hlY2tib3hdXCIpO1xyXG4gICAgYWxsQ2x1YkNoZWNrQm94ZXMuY2xpY2soKCkgPT4ge1xyXG4gICAgICAgIGF1dG9TZWxlY3RBbGxDbHVicyA9IGZhbHNlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gaW1wb3J0YW50IHRvIHVzZSBmdW5jdGlvbigpIChhbm9ueW1vdXMgZnVuY3Rpb24pIGhlcmUgYW4gbm90IGFuIGFycm93IGZ1bmN0aW9uXHJcbiAgICAvLyB1c2luZyBhbiBhcnJvdyBmdW5jdGlvbiB3aWxsIGNoYW5nZSB0aGUgXCJ0aGlzXCIgaW5zaWRlXHJcbiAgICAkKFwiW25hbWU9J2V2bnRfdHlwZSddXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBsZXQgcHJvcCA9ICQodGhpcykudmFsKCk7XHJcbiAgICAgICAgbGV0IGlzSW50ZXJuYWxFdmVudCA9IGludGVybmFsRXZlbnRWYWx1ZXMuaW5kZXhPZihwcm9wKSAhPT0gLTE7XHJcbiAgICAgICAgaWYgKGlzSW50ZXJuYWxFdmVudCkge1xyXG4gICAgICAgICAgICBpZiAoYXV0b1NlbGVjdEFsbENsdWJzKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI2ZpbHRlclwiKS5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF1cIikucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHJlc2V0IGFsbCBjaGVja2JveGVzXHJcbiAgICAgICAgICAgICQoXCIjZmlsdGVyXCIpLmZpbmQoXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKS5wcm9wKFwiY2hlY2tlZFwiLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGxldCBjbHViTmFtZSA9ICQoZG9jdW1lbnQpLmZpbmQoXCIjcGxhY2VcIikudmFsKCk7XHJcbiAgICAgICAgICAgIGxldCBjbHViSWQgPSBnZXRJZE9mQ2x1YihjbHViTmFtZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoY2x1YklkICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHNob3dUb0NsdWJDaGVja2JveCA9ICQoZG9jdW1lbnQpLmZpbmQoXCJbbmFtZT1maWx0ZXJTaG93VG9DbHViXCIgKyBjbHViSWQgKyBcIl1cIik7XHJcbiAgICAgICAgICAgICAgICBzaG93VG9DbHViQ2hlY2tib3gucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIlV0aWxpdGllcy50c1wiLz5cclxuXHJcblxyXG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XHJcblxyXG5jbGFzcyBRdWVzdGlvbiB7XHJcblxyXG4gICAgcHJpdmF0ZSBxdWVzdGlvbkRpdjogSlF1ZXJ5O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMucXVlc3Rpb25EaXYgPSAkKGVsZW1lbnQpLmNsb3Nlc3QoJ1tuYW1lXj1xdWVzdGlvbl0nKTtcclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
